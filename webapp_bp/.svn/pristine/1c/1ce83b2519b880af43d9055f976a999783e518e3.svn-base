$(function() {
    $.ajax({
        type: 'POST',
        url: yonghui.contextPath + '/api/money/getBalance.jsp',
        data: '',
        dataType: 'json',
        success: function(data) {
            if (data.errCode == 0) {
                getUser(data);
            }
        },
        error: function(data) {
            console.log("失败");
        }
    });
    /*获得账户名称和余额*/
    function getUser(data) {
        var data = eval(data.obj);
        var acctName = data.acctName;
        var balance = (data.balance / 100).toFixed(2);
        $('.info .name').html(acctName);
        $('.info .balance').html("￥" + balance);
    }
    /*点击下一步*/
    var money, mode;
    $('.btn-next').click(function() {
        money = $('.money').val();
        if ($('#pay-wechat').is(':checked') == true) {
            mode = '100';
        } else if ($('#pay-ali').is(':checked') == true) {
            mode = '200';
        } else {
            mode = '300';
        }
        PayWay();
    });

    /*获得充值单号，判断充值方式，并调转*/
    var tradeno;
    function PayWay() {
        $.ajax({
            type: 'POST',
            url: yonghui.contextPath + '/api/money/recharge.jsp',
            data: { 'money': money, 'mode': mode },
            dataType: 'json',
            success: function(data) {
            	console.log(mode);
                if (data.errCode == 0) {
                    tradeno = data.obj;
                    if (mode == '100') {
                        window.open('http://testbp.stormad.cn/wxpay/qrcode/deposit.jsp?tradeno=' + tradeno);
                    } else if (mode == '200') {
                    	window.open('http://testbp.stormad.cn/alipay/deposit/deposit.jsp?tradeno=' + tradeno);
                    } else if (mode == '300') {
                    	window.open('http://testbp.stormad.cn/unionpay/deposit/deposit.jsp?tradeno=' + tradeno);
                    }
                }
            },
            error: function(data) {

            }
        });
    }
})
