package com.yonghui.webapp.bss.api.ader;

import java.io.IOException;
import java.io.Writer;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import com.yonghui.comp.ader.share.AderClient;
import com.yonghui.comp.ader.share.AderService;
import com.yonghui.comp.ader.share.bean.AderEntity;
import com.yonghui.comp.admin.share.bean.AdminEntity;
import com.yonghui.webapp.bss.api.ApiHandler;
import com.yonghui.webapp.bss.util.JsonUtil;

import cn770880.jutil.data.RespWrapper;
import cn770880.jutil.string.StringUtil;

public class UpdateHandler implements ApiHandler {

	@Override
	public void handle(HttpServletRequest request, HttpServletResponse response, Writer out, AdminEntity admin)
			throws IOException {
		RespWrapper<Boolean> resp = RespWrapper.makeResp(2002, "更新广告主资料失败", false);
		
		int tuin = StringUtil.convertInt(request.getParameter("tuin"), 0);
		if(tuin == 0) {
			resp.setErrMsg("请选择需要修改资料的广告主");
			JsonUtil.MAPPER.writeValue( out, resp);
			return;
		}
		
		AderService service = AderClient.getAderService();
		AderEntity entity = service.findById(tuin).getObj();
		if(entity == null) {
			resp.setErrMsg("请选择需要修改资料的广告主");
			JsonUtil.MAPPER.writeValue( out, resp);
			return;
		}

		String corporation = request.getParameter("corporation");
		String province = request.getParameter("province");
		String city = request.getParameter("city");
		String district = request.getParameter("district");
		String address = request.getParameter("address");
		String legalPerson = request.getParameter("legalPerson");
		String legalIdcard = request.getParameter("legalIdcard");
		String bank = request.getParameter("bank");
		String accountName = request.getParameter("accountName");
		String cardNo = request.getParameter("cardNo");
		String loginName = request.getParameter("loginName");
		String password = request.getParameter("password");
		String contact = request.getParameter("contact");
		String phone = request.getParameter("phone");
		String email = request.getParameter("email");
		String orgCode = request.getParameter("orgCode");
		String busiRegNo = request.getParameter("busiRegNo");
		String logoUrl = request.getParameter("logoUrl");
		String busiLicenseUrl = request.getParameter("busiLicenseUrl");
		String taxCertifyUrl = request.getParameter("taxCertifyUrl");
		
		entity.setAdUin(tuin);
		entity.setCorporation(corporation);
		entity.setProvince(province);
		entity.setCity(city);
		entity.setDistrict(district);
		entity.setAddress(address);
		entity.setLegalPerson(legalPerson);
		entity.setLegalIdcard(legalIdcard);
		entity.setBank(bank);
		entity.setAccountName(accountName);
		entity.setCardNo(cardNo);
		entity.setLoginName(loginName);
		entity.setPassword(password);
		entity.setContact(contact);
		entity.setPhone(phone);
		entity.setEmail(email);
		entity.setOrgCode(orgCode);
		entity.setBusiRegNo(busiRegNo);
		entity.setLogoUrl(logoUrl);
		entity.setBusiLicenseUrl(busiLicenseUrl);
		entity.setTaxCertifyUrl(taxCertifyUrl);
		entity.setUtype(1);
		entity.setNotifyPhone(phone);
		entity.setChgUser(admin.getAdmUin());
		entity.setChgTime(System.currentTimeMillis());
		
		resp = service.update(entity);
		JsonUtil.MAPPER.writeValue( out, resp);
	}

}
